Here's the complete modified code incorporating the requested API route additions and middleware integration for enhanced functionality and consistency.
```